<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Админка — записи</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Админка: все записи</h1>
  <table border="1" cellpadding="4">
    <thead>
      <tr>
        <th>ID</th>
        <th>ФИО</th>
        <th>Телефон</th>
        <th>Telegram</th>
        <th>Дата</th>
        <th>Время</th>
        <th>Запрос</th>
        <th>Статус</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody id="appointments-body"></tbody>
  </table>

  <script>
    const apiBase = 'http://localhost:3000/api';

    function loadAppointments() {
      fetch(`${apiBase}/admin/appointments`)
        .then(res => res.json())
        .then(data => {
          const body = document.getElementById('appointments-body');
          body.innerHTML = '';
          data.forEach(appt => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${appt.id}</td>
              <td>${appt.full_name}</td>
              <td>${appt.phone}</td>
              <td>${appt.telegram_nick || ''}</td>
              <td>${appt.date}</td>
              <td>${appt.time}</td>
              <td>${appt.short_request || ''}</td>
              <td>${appt.status}</td>
              <td>
                ${appt.status === 'pending'
                  ? `<button data-id="${appt.id}" class="confirm-btn">Подтвердить</button>`
                  : ''}
              </td>
            `;
            body.appendChild(tr);
          });

          document.querySelectorAll('.confirm-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const id = btn.getAttribute('data-id');
              fetch(`${apiBase}/admin/appointments/${id}/confirm`, {
                method: 'POST'
              })
                .then(res => res.json())
                .then(() => loadAppointments())
                .catch(console.error);
            });
          });
        })
        .catch(console.error);
    }

    loadAppointments();
  </script>
</body>
</html>
